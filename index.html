<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Closed Box Corridor Gallery â€“ My Works</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #ffffff; overflow: hidden; font-family: system-ui, sans-serif; }
    .info {
      position: fixed;
      left: 10px;
      top: 10px;
      padding: 6px 10px;
      font-size: 12px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      border-radius: 4px;
      z-index: 10;
      user-select: none;
    }
         .detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: center;

      /* ì²˜ìŒì—” ì•ˆ ë³´ì´ê²Œ */
      opacity: 0;
      visibility: hidden;
      pointer-events: none;

      /* ë¶€ë“œëŸ¬ìš´ ë‚˜íƒ€ë‚¨/ì‚¬ë¼ì§ */
      transition: opacity 0.35s ease;
    }

    /* ì—´ë ¸ì„ ë•Œ ìƒíƒœ */
    .detail-overlay.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    .detail-inner {
      position: relative;
      width: 90vw;
      height: 80vh;
      display: flex;
      gap: 32px;
      color: #fff;
      font-family: system-ui, sans-serif;

      /* ì‚´ì§ ì•„ë˜ì—ì„œ ìœ„ë¡œ ì˜¬ë¼ì˜¤ëŠ” ëŠë‚Œ */
      transform: translateY(20px);
      opacity: 0;
      transition: transform 0.35s ease, opacity 0.35s ease;
    }

    .detail-overlay.show .detail-inner {
      transform: translateY(0);
      opacity: 1;
    }

    .detail-left {
      flex: 3;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .detail-left img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .detail-right {
      flex: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-right: 16px;
    }

    .detail-right h2 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 600;
    }

    .detail-right p {
      margin: 0;
      font-size: 15px;
      line-height: 1.7;
      white-space: pre-line;
      color: #ddd;
    }

    .detail-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 20px;
      cursor: pointer;
    }

    .detail-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }


  </style>
</head>
<body>
    <div class="info">
    ë§ˆìš°ìŠ¤ ë“œë˜ê·¸: ì‹œì  íšŒì „ Â· W/S: ì•/ë’¤ Â· A/D: ì¢Œìš° ì´ë™<br>
    ê·¸ë¦¼ì„ í´ë¦­í•˜ì„¸ìš”
  </div>

  <!-- âœ… ì „ì²´ í™”ë©´ ë””í…Œì¼ ë·° ì˜¤ë²„ë ˆì´ -->
  <div class="detail-overlay">
    <div class="detail-inner">
      <button class="detail-close" type="button">Ã—</button>
      <div class="detail-left">
        <img id="detail-img" src="" alt="ì„ íƒëœ ì‘í’ˆ" />
      </div>
      <div class="detail-right">
        <h2 id="detail-title">ì‘í’ˆì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
        <p id="detail-desc">
          ë³µë„ ì–‘ìª½ ë²½ì˜ ê·¸ë¦¼ì„ í´ë¦­í•˜ë©´ ì´ ì˜ì—­ì— ì œëª©ê³¼ ì„¤ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.
        </p>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

 <script>
  // ===== ë Œë”ëŸ¬ & ì”¬ & ì¹´ë©”ë¼ =====
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setClearColor(0x000000, 1); // ğŸ”¥ ì „ì²´ ë°°ê²½ì„ ê¹Œë§£ê²Œ
  document.body.appendChild(renderer.domElement);

  const scene = new THREE.Scene();

  // ğŸ”¥ ì•„ì£¼ ì•½í•œ ì „ì²´ ì¡°ëª…
  const ambient = new THREE.AmbientLight(0xffffff, 0.05);
  scene.add(ambient);

  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  const clickableFrames = [];

  // ë””í…Œì¼ ì˜¤ë²„ë ˆì´ DOM
  const overlay      = document.querySelector(".detail-overlay");
  const detailImg    = document.getElementById("detail-img");
  const detailTitle  = document.getElementById("detail-title");
  const detailDesc   = document.getElementById("detail-desc");
  const detailClose  = document.querySelector(".detail-close");

  const camera = new THREE.PerspectiveCamera(
    60,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );

  // ì‹œì : ê·¸ë¦¼ ë†’ì´ì™€ ê°™ê²Œ (y = 7), ì…êµ¬ ìª½ì—ì„œ ì‹œì‘
  const EYE_HEIGHT = 7;
  camera.position.set(0, EYE_HEIGHT, -8);

  let yaw = 0;
  let pitch = 0;

  // ===== í†µì§œ ë³µë„(ë°•ìŠ¤) =====
  const corridorWidth = 20;
  const corridorHeight = 12;
  const corridorDepth = 100;

  const corridorGeo = new THREE.BoxGeometry(
    corridorWidth,
    corridorHeight,
    corridorDepth
  );

  const corridorMat = new THREE.MeshStandardMaterial({
    color: 0x111111,
    roughness: 1,
    metalness: 0,
    side: THREE.BackSide
  });

  // ğŸ”¥ ì‹¤ì œ ë³µë„ ë©”ì‰¬ë¥¼ ë§Œë“¤ì–´ì„œ sceneì— ì¶”ê°€ (ì´ê²Œ ì—†ì–´ì„œ ê·¸ë™ì•ˆ ë²½ì´ ì•ˆ ë³´ì˜€ìŒ)
  const corridor = new THREE.Mesh(corridorGeo, corridorMat);
  corridor.position.set(0, corridorHeight / 2, -corridorDepth / 2);
  scene.add(corridor);

  // ë°”ë‹¥
    // ===== ë°”ë‹¥ =====
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(corridorWidth, corridorDepth),
    new THREE.MeshStandardMaterial({
      color: 0x0f0f0f,
      roughness: 1,
      metalness: 0
    })
  );
  floor.rotation.x = -Math.PI / 2;
  floor.position.set(0, 0.001, -corridorDepth / 2);
  scene.add(floor);

  // =========================
  // âœ… ë³µë„ ë ë²½ ë¹„ë””ì˜¤ ìŠ¤í¬ë¦°
  // =========================

  // 1) HTMLVideoElement ìƒì„±
  const endVideo = document.createElement("video");
  endVideo.src = "./img/pong.mp4";       // ğŸ‘‰ ì‹¤ì œ íŒŒì¼ ê²½ë¡œ í™•ì¸!
  endVideo.muted = true;                 // ìë™ì¬ìƒ ìœ„í•´ ë°˜ë“œì‹œ muted
  endVideo.loop = true;                  // ë¬´í•œ ë°˜ë³µ
  endVideo.playsInline = true;           // ëª¨ë°”ì¼ ì „ì²´í™”ë©´ ë°©ì§€
  endVideo.autoplay = true;
  endVideo.crossOrigin = "anonymous";

  // ìë™ì¬ìƒ ê°•ì œ ì‹œë„ + ìƒí˜¸ì‘ìš© í›„ ì¬ì‹œë„
  function tryPlayEndVideo() {
    endVideo.play().catch(() => {
      // ì‹¤íŒ¨í•´ë„ ì—ëŸ¬ë§Œ ë¨¹ê³  ë (ì½˜ì†”ì— ì•ˆ ë‚˜ì™€ì„œ ì¡°ìš©í•¨)
    });
  }

  // ë©”íƒ€ë°ì´í„° ë¡œë“œë˜ë©´ í•œ ë²ˆ ì¬ìƒ ì‹œë„
  endVideo.addEventListener("loadeddata", () => {
    tryPlayEndVideo();
  });

  // ì‚¬ìš©ìê°€ ì•„ë¬´ê±°ë‚˜ í•œ ë²ˆì´ë¼ë„ í´ë¦­í•˜ë©´ ë‹¤ì‹œ ì¬ìƒ ì‹œë„ (ì •ì±… ìš°íšŒ)
  window.addEventListener("click", () => {
    if (endVideo.paused) {
      tryPlayEndVideo();
    }
  }, { once: true });

  // 2) VideoTextureë¡œ ë³€í™˜
  const endVideoTex = new THREE.VideoTexture(endVideo);
  endVideoTex.minFilter = THREE.LinearFilter;
  endVideoTex.magFilter = THREE.LinearFilter;
  endVideoTex.generateMipmaps = false;
  endVideoTex.colorSpace = THREE.SRGBColorSpace ?? THREE.sRGBEncoding;

  const endVideoMat = new THREE.MeshBasicMaterial({
  map: endVideoTex,
  side: THREE.DoubleSide,
  transparent: true,
  opacity: 0.2,   // âœ… ì²˜ìŒì—” ì–´ë‘¡ê²Œ ì‹œì‘
  toneMapped: false
});


  // 3) í™”ë©´ ë¹„ìœ¨(16:9 ê¸°ì¤€)ë¡œ Plane ë§Œë“¤ê¸°
  const screenWidth = corridorWidth * 0.7;      // ë³µë„ í­ì˜ 70% ì •ë„ ì°¨ì§€
  const screenHeight = (screenWidth / 16) * 9;  // 16:9 ë¹„ìœ¨

  const endScreenGeo = new THREE.PlaneGeometry(screenWidth, screenHeight);
  const endScreen = new THREE.Mesh(endScreenGeo, endVideoMat);

  // ë³µë„ ë ë²½ ìœ„ì¹˜ (ì œì¼ ë z ìª½ì— ì‚´ì§ ë„ì›Œì„œ ë°°ì¹˜)
  endScreen.position.set(
    0,
    corridorHeight / 2,          // ì„¸ë¡œ ì¤‘ì•™ ê·¼ì²˜
    -corridorDepth + 0.5         // ë§¨ ëì—ì„œ ì•½ê°„ ë” ì•ìœ¼ë¡œ (ë²½ë³´ë‹¤ ì‚´ì§ ì•ˆìª½)
  );

  // Plane ê¸°ë³¸ ë°©í–¥(Z+) ê·¸ëŒ€ë¡œ ë‘ê¸°
  // (side: DoubleSideë¼ ë°©í–¥ í‹€ë ¤ë„ ë³´ì„)
  // endScreen.rotation.y = Math.PI; // ì´ê±´ ì¼ë‹¨ ì£¼ì„ ì²˜ë¦¬

  scene.add(endScreen);



  // ===== ì•¡ì ìƒì„± í•¨ìˆ˜ (í…ìŠ¤ì²˜ ì‚¬ìš© + ë¹„ìœ¨ ìë™ ë§ì¶”ê¸° + í´ë¦­ + ìŠ¤í¬íŠ¸ë¼ì´íŠ¸) =====
  function createFrame(texture, index, x, y, z, rotY) {
  const group = new THREE.Group();

  // ì´ë¯¸ì§€ ë¹„ìœ¨ ê³„ì‚°
  let aspect = 1;
  if (texture.image && texture.image.width && texture.image.height) {
    aspect = texture.image.width / texture.image.height;
  }

  const baseHeight = 3.0;
  const picH = baseHeight;
  const picW = baseHeight * aspect;

  // ğŸ¨ ê·¸ë¦¼ ë©”ì‰¬ (ì¡°ëª… ë°›ëŠ” ì¬ì§ˆ)
  const picGeo = new THREE.PlaneGeometry(1, 1);
  const picMat = new THREE.MeshStandardMaterial({
    map: texture,
    roughness: 0.7,
    metalness: 0
  });
  const picture = new THREE.Mesh(picGeo, picMat);
  picture.scale.set(picW, picH, 1);
  picture.position.z = 0.02;
  group.add(picture);

  // ê·¸ë£¹ ìœ„ì¹˜/íšŒì „
  group.position.set(x, y, z);
  group.rotation.y = rotY;

  // í´ë¦­ìš© ì¸ë±ìŠ¤
  group.userData.index = index;
  clickableFrames.push(group);
  scene.add(group);

  // =========================
  // âœ… ì´ ê·¸ë¦¼ë§Œ ë¹„ì¶”ëŠ” ìŠ¤í¬íŠ¸ë¼ì´íŠ¸
  //    (ê·¸ë¦¼ ê·¸ë£¹ì˜ "ìì‹"ìœ¼ë¡œ ë„£ì–´ì„œ í•­ìƒ ê·¸ë¦¼ ìª½ì„ í–¥í•˜ë„ë¡)
  // =========================
  const spot = new THREE.SpotLight(
    0xffffff,
    9.0,          // ë°ê¸° (ë„ˆë¬´ ë°ìœ¼ë©´ 3.0, ë¶€ì¡±í•˜ë©´ 5.0 ì •ë„)
    15,           // ë„ë‹¬ ê±°ë¦¬
    Math.PI / 6,  // í¼ì§ ê°ë„ (ì¢ê²Œ â†’ ìŠ¤íŒŸ ëŠë‚Œ)
    0.4,
    1
  );

  // ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ë¥¼ ê·¸ë£¹ ë¡œì»¬ ì¢Œí‘œë¡œ ë°°ì¹˜
  //  - ê·¸ë¦¼ ìœ„ìª½ (y: picH/2 + 2)
  //  - ê·¸ë¦¼ì—ì„œ ì•½ê°„ ì•ìª½ìœ¼ë¡œ íŠ€ì–´ë‚˜ì˜¤ê²Œ (z: 3)
  spot.position.set(0, picH / 2 + 2, 3);

  // ì¡°ëª…ì´ ë°”ë¼ë³¼ íƒ€ê²Ÿ(ê·¸ë¦¼ ì¤‘ì‹¬)ì„ ê·¸ë£¹ ì•ˆì— ë”°ë¡œ ë§Œë“¤ì–´ì„œ ì§€ì •
  const target = new THREE.Object3D();
  target.position.set(0, 0, 0); // ê·¸ë£¹ì˜ ì¤‘ì‹¬ â‰ˆ ê·¸ë¦¼ ì¤‘ì‹¬
  group.add(target);

  spot.target = target;

  // ì¤‘ìš”: ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ë„ ê·¸ë£¹ì˜ ìì‹ìœ¼ë¡œ ë„£ê¸°
  group.add(spot);

  // í•„ìš”í•˜ë©´ ë°©í–¥ í™•ì¸ìš© í—¬í¼
  // const helper = new THREE.SpotLightHelper(spot);
  // scene.add(helper);
}


  // ===== ê·¸ë¦¼ ê²½ë¡œ, ì œëª©, ì„¤ëª… =====
  const framesPerSide = 10;
  const totalFrames = framesPerSide * 2; // ì™¼ìª½+ì˜¤ë¥¸ìª½ = 20ì¥

  const imagePaths = [
    "./img/1.jpg",
    "./img/2.jpg",
    "./img/3.jpg",
    "./img/4.jpg",
    "./img/5.jpg",
    "./img/6.jpg",
    "./img/7.jpg",
    "./img/8.jpg",
    "./img/9.jpg",
    "./img/10.jpg",
    "./img/11.jpg",
    "./img/12.jpg",
    "./img/13.jpg",
    "./img/14.jpg",
    "./img/15.jpg",
    "./img/16.jpg",
    "./img/17.jpg",
    "./img/18.jpg",
    "./img/19.jpg",
    "./img/20.jpg"
  ];

  const titles = [
    "ì‘í’ˆ 1 ì œëª©","ì‘í’ˆ 2 ì œëª©","ì‘í’ˆ 3 ì œëª©","ì‘í’ˆ 4 ì œëª©","ì‘í’ˆ 5 ì œëª©",
    "ì‘í’ˆ 6 ì œëª©","ì‘í’ˆ 7 ì œëª©","ì‘í’ˆ 8 ì œëª©","ì‘í’ˆ 9 ì œëª©","ì‘í’ˆ 10 ì œëª©",
    "ì‘í’ˆ 11 ì œëª©","ì‘í’ˆ 12 ì œëª©","ì‘í’ˆ 13 ì œëª©","ì‘í’ˆ 14 ì œëª©","ì‘í’ˆ 15 ì œëª©",
    "ì‘í’ˆ 16 ì œëª©","ì‘í’ˆ 17 ì œëª©","ì‘í’ˆ 18 ì œëª©","ì‘í’ˆ 19 ì œëª©","ì‘í’ˆ 20 ì œëª©"
  ];

  const descriptions = [
    "ì‘í’ˆ 1 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 2 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 3 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 4 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 5 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 6 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 7 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 8 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 9 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 10 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 11 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 12 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 13 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 14 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 15 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 16 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 17 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 18 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 19 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”.",
    "ì‘í’ˆ 20 ì„¤ëª…ì„ ì—¬ê¸°ì— ì ì–´ ì£¼ì„¸ìš”."
  ];

  while (imagePaths.length < totalFrames) {
    imagePaths.push(imagePaths[imagePaths.length - 1]);
  }

  const loader = new THREE.TextureLoader();
  const textures = new Array(totalFrames);
  let loadedCount = 0;

  imagePaths.forEach((path, index) => {
    loader.load(
      path,
      tex => {
        tex.colorSpace = THREE.SRGBColorSpace ?? THREE.sRGBEncoding;
        textures[index] = tex;
        loadedCount++;
        if (loadedCount === totalFrames) {
          placeFrames();
        }
      },
      undefined,
      err => {
        console.warn("ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨:", path);
        const canvas = document.createElement("canvas");
        canvas.width = canvas.height = 2;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#888";
        ctx.fillRect(0, 0, 2, 2);
        const dummy = new THREE.CanvasTexture(canvas);
        textures[index] = dummy;

        loadedCount++;
        if (loadedCount === totalFrames) {
          placeFrames();
        }
      }
    );
  });

  // ===== ì•¡ì ë°°ì¹˜ (ì–‘ìª½ ë²½) =====
  function placeFrames() {
    const spacingZ = 8;
    const startZ = -20;
    const frameY = EYE_HEIGHT;
    const wallX = corridorWidth / 2 - 0.1;

    for (let i = 0; i < framesPerSide; i++) {
      const z = startZ - i * spacingZ;

      const texLeft  = textures[i];                 // 0~9  â†’ ì™¼ìª½
      const texRight = textures[i + framesPerSide]; // 10~19 â†’ ì˜¤ë¥¸ìª½

      createFrame(texLeft,  i, -wallX, frameY, z, Math.PI / 2);
      createFrame(texRight, i + framesPerSide,  wallX, frameY, z, -Math.PI / 2);
    }
  }

  // ===== í‚¤ë³´ë“œ (WASD) =====
  const keys = {};
  window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
  window.addEventListener("keyup",   e => keys[e.key.toLowerCase()] = false);

  // ===== ë§ˆìš°ìŠ¤ ì‹œì  íšŒì „ =====
  let isMouseDown = false;
  let lastMouseX = 0;
  let lastMouseY = 0;
  const mouseSensitivity = 0.002;

  window.addEventListener("mousedown", e => {
    isMouseDown = true;
    lastMouseX = e.clientX;
    lastMouseY = e.clientY;
  });

  window.addEventListener("mouseup",   () => isMouseDown = false);
  window.addEventListener("mouseleave", () => isMouseDown = false);

  window.addEventListener("mousemove", e => {
    if (!isMouseDown) return;

    const dx = e.clientX - lastMouseX;
    const dy = e.clientY - lastMouseY;

    lastMouseX = e.clientX;
    lastMouseY = e.clientY;

    yaw   -= dx * mouseSensitivity;
    pitch -= dy * mouseSensitivity;

    const maxPitch = Math.PI / 3;
    if (pitch >  maxPitch) pitch =  maxPitch;
    if (pitch < -maxPitch) pitch = -maxPitch;
  });

  function getForwardDir() {
    const dir = new THREE.Vector3();
    dir.x = Math.sin(yaw) * Math.cos(pitch);
    dir.y = Math.sin(pitch);
    dir.z = -Math.cos(yaw) * Math.cos(pitch);
    return dir.normalize();
  }

  // ===== ì¹´ë©”ë¼ ì´ë™ & ì œí•œ =====
  function updateCamera() {
    const speed = 0.35;
    const forward = getForwardDir();
    const right = new THREE.Vector3()
      .crossVectors(forward, new THREE.Vector3(0,1,0))
      .normalize();

    if (keys["w"]) camera.position.addScaledVector(forward,  speed);
    if (keys["s"]) camera.position.addScaledVector(forward, -speed);
    if (keys["a"]) camera.position.addScaledVector(right,   -speed);
    if (keys["d"]) camera.position.addScaledVector(right,    speed);

    camera.position.y = EYE_HEIGHT;

    const halfW = corridorWidth / 2 - 1;
    const nearZ = -1;
    const farZ  = -corridorDepth + 1;

    camera.position.x = Math.max(-halfW, Math.min(halfW, camera.position.x));
    camera.position.z = Math.max(farZ, Math.min(nearZ, camera.position.z));

    const lookTarget = new THREE.Vector3().copy(camera.position).add(forward);
    camera.lookAt(lookTarget);
  }

  // ===== ì˜¤ë²„ë ˆì´ í´ë¦­ ë¡œì§ =====
  renderer.domElement.addEventListener("click", onClick, false);

  function onClick(event) {
    const rect = renderer.domElement.getBoundingClientRect();

    mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);

    const intersects = raycaster.intersectObjects(clickableFrames, true);
    if (intersects.length === 0) return;

    let obj = intersects[0].object;
    while (obj && obj.parent && obj.userData.index === undefined) {
      obj = obj.parent;
    }
    if (!obj || obj.userData.index === undefined) return;

    const index = obj.userData.index;

    overlay.classList.add("show");
    detailImg.src = imagePaths[index];
    detailTitle.textContent = titles[index] || `ì‘í’ˆ ${index + 1}`;
    detailDesc.textContent  = descriptions[index] || "";
  }

  detailClose.addEventListener("click", () => {
    overlay.classList.remove("show");
  });

  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      overlay.classList.remove("show");
    }
  });

  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) {
      overlay.classList.remove("show");
    }
  });

  // ===== ë¦¬ì‚¬ì´ì¦ˆ =====
  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // ===== ë£¨í”„ =====
  function animate() {
  requestAnimationFrame(animate);
  updateCamera();

  // =========================
  // âœ… ë¹„ë””ì˜¤ ê±°ë¦¬ ê¸°ë°˜ ë°ê¸° ì¡°ì ˆ
  // =========================
  const dist = camera.position.distanceTo(endScreen.position);

  // ë¨¼ ê±°ë¦¬ / ê°€ê¹Œìš´ ê±°ë¦¬ ê¸°ì¤€ê°’
  const FAR  = 70;   // ì´ë³´ë‹¤ ë©€ë©´ ê±°ì˜ ì–´ë‘ì›€
  const NEAR = 12;   // ì´ë³´ë‹¤ ê°€ê¹Œìš°ë©´ ì™„ì „ ë°ìŒ

  let t = (FAR - dist) / (FAR - NEAR);
  t = Math.max(0, Math.min(1, t)); // 0~1ë¡œ ì œí•œ

  // âœ… ì–´ë‘ì›€ â†’ ë°ìŒ ë¶€ë“œëŸ½ê²Œ ë³´ê°„
  endVideoMat.opacity = 0.15 + t * 0.85;
  // ê²°ê³¼: 0.15 ~ 1.0 ì‚¬ì´

  renderer.render(scene, camera);
}

  animate();
</script>

</body>
</html>
